var Jetlink={Settings:{Widget:{OnlineWidgetUrl:"",ChatWindowBackgroundImageUrl:"",ChatWindowBackgroundColor:"",SendButtonText:"",MessageTextBoxPlaceholder:""}},Rules:{IsVisitorEmailRequired:!1},Init:function(e,t){var a=document.createElement("script");a.src=SDKSource.General.BaseUrl+"/files/js/jquery-3.1.0.min.js",a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a),a=document.createElement("script"),a.src=SDKSource.General.BaseUrl+"/files/js/strophe.min.js",a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a),setTimeout(function(){SDKSource.CheckAppId(e,t)},1e3)},Localize:function(e){SDKSource.Language.Code=e}},SDKSource={Language:{Code:"en",Data:null},General:{BaseUrl:"https://public.jetlink.io",CompanyId:"",CompanyChatUserId:"",SenderChatUserId:"",SenderChatUserPsw:"",UserId:"",IsNewConversation:!0},ChatServer:{ChatConn:null,ChatConnStatus:null,BoshService:"",ChatDomain:"",UserChatPsw:""},CheckAppId:function(e,t){$.get(SDKSource.General.BaseUrl+"/WebChatData/GetApiKeyDetail?appId="+e+"&appToken="+t,function(e){return""==e?void console.log("Jetlink Error: Invalid appId or appToken!"):(SDKSource.General.CompanyId=e.CompanyId,SDKSource.CreateChatLinkElement(),$.getJSON(SDKSource.General.BaseUrl+"/JsonData/LanguageDataWebWidget.json",function(e){SDKSource.Language.Data=e}),void SDKSource.ApplyDeveloperSettings())})},ApplyDeveloperSettings:function(){""!=Jetlink.Settings.Widget.OnlineWidgetUrl&&$("#imgOpenChatWindow").attr("src",Jetlink.Settings.Widget.OnlineWidgetUrl),""!=Jetlink.Settings.Widget.SendButtonText&&$("#btnMessageSend").html(Jetlink.Settings.Widget.SendButtonText),""!=Jetlink.Settings.Widget.MessageTextBoxPlaceholder&&$("#txtMessageContent").attr("placeholder",Jetlink.Settings.Widget.MessageTextBoxPlaceholder),""==Jetlink.Settings.Widget.ChatWindowBackgroundColor&&""==Jetlink.Settings.Widget.ChatWindowBackgroundImageUrl?($("#jtlnk-conversation").css("background-image","url('https://public.jetlink.io/files/img/chat-window-bg.png')"),$("#jtlnk-conversation").css("background-size","100%")):(console.log("a"),""!=Jetlink.Settings.Widget.ChatWindowBackgroundImageUrl?($("#jtlnk-conversation").css("background-image","url('"+Jetlink.Settings.Widget.ChatWindowBackgroundImageUrl+"')"),$("#jtlnk-conversation").css("background-size","100%")):""!=Jetlink.Settings.Widget.ChatWindowBackgroundColor&&$("#jtlnk-conversation").css("background-color",""+Jetlink.Settings.Widget.ChatWindowBackgroundColor))},Localize:function(){$("#spanTypeYourEmail").text(SDKSource.GetLanguageData("type_email")),$("#txtEmail").attr("placeholder",SDKSource.GetLanguageData("type_here_email")),$("#btnMessageSend").html(SDKSource.GetLanguageData("send")),$("#txtMessageContent").attr("placeholder",SDKSource.GetLanguageData("type_here_message"))},CreateChatLinkElement:function(){jQuery.ajaxSetup({async:!1}),$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatLink.html",function(e){$("body").append(e)})},OpenChatWindow:function(){$("#JetlinkWebChat").remove(),$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatWindow.css?v=10",function(e){e='<style type="text/css" id="cssChatWindow">'+e+"</style>",$("head").append(e)}),$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatWindow.html?v=3",function(e){$.ajax({url:SDKSource.General.BaseUrl+"/WebChatData/GetCompanyDetail?id="+SDKSource.General.CompanyId,type:"GET",data:"",success:function(t){""!=t?(e=e.replace(/%WebChatInfoTitle%/g,t.WebChatInfoTitle),e=e.replace(/%WebChatInfoText%/g,t.WebChatInfoText),e=e.replace(/%WebChatInfoImage%/g,t.WebChatInfoImage)):(e=e.replace(/%WebChatInfoTitle%/g,"Jetlink"),e=e.replace(/%WebChatInfoText%/g,SDKSource.GetLanguageData("we_are_here")),e=e.replace(/%WebChatInfoImage%/g,SDKSource.General.BaseUrl+"/files/img/jetlink-icon-white.png")),$.get(SDKSource.General.BaseUrl+"/WebChatData/GetCompanyGeneralChatUser?companyId="+SDKSource.General.CompanyId,function(t){return""==t?void console.log("Jetlink Error: Invalid Agent Id!"):(SDKSource.General.CompanyChatUserId=t,void $.get(SDKSource.General.BaseUrl+"/WebChatData/GetSystemConfigurations?companyId="+SDKSource.General.CompanyId,function(t){if(""==t)return void console.log("Jetlink Error: Invalid System Configuration!");for(var a=0;a<t.length;a++)"ChatServerDomain"==t[a].Key?SDKSource.ChatServer.ChatDomain=t[a].Value:"BoshServiceUrl"==t[a].Key?SDKSource.ChatServer.BoshService=t[a].Value:"UsersDefaultChatPassword"==t[a].Key&&(SDKSource.ChatServer.UserChatPsw=t[a].Value);$("body").append(e),SDKSource.Localize(),SDKSource.ApplyDeveloperSettings(),""!=SDKSource.GetCookie("Jetlink-LastConversationId")&&SDKSource.DisplayPreviousMessages(),""==SDKSource.GetCookie("Jetlink-UserId")?1==Jetlink.Rules.IsVisitorEmailRequired&&""==SDKSource.GetCookie("Jetlink-LastConversationId")?($("#btnMessageSend").show(),$("#txtEmail").show(),$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(e){e=e.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-left-row"),e=e.replace(/%MessageId%/g,"11"),e=e.replace(/%FromName%/g,""),e=e.replace(/%AvatarUrl%/g,""),e=e.replace(/%MessageContent%/g,SDKSource.GetLanguageData("type_email")),$("#divJetlinkMessageList").append(e),$("#divFromName_11").remove(),$("#imgAvatarUrl_11").remove(),$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3)})):($("#btnMessageSend").show(),$("#txtMessageContent").show(),SDKSource.StartConversation()):SDKSource.StartConversation()}))})}})})},MessageSend:function(){if(1==Jetlink.Rules.IsVisitorEmailRequired){var e=$("#txtEmail").val();""!=e&&(SDKSource.validateEmail(e)?$.get(SDKSource.General.BaseUrl+"/WebChatData/ChatUserDetail?email="+e+"&companyId="+SDKSource.General.CompanyId,function(e){""!=e&&(SDKSource.General.SenderChatUserId=e.ChatUserId,SDKSource.General.UserId=e.UserId,SDKSource.General.SenderChatUserPsw=e.ChatPsw,SDKSource.SetCookie("Jetlink-Visitor-ChatUserId",SDKSource.General.SenderChatUserId),SDKSource.SetCookie("Jetlink-Visitor-ChatUserPsw",SDKSource.General.SenderChatUserPsw),SDKSource.SetCookie("Jetlink-Visitor-UserId",SDKSource.General.UserId),$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(e){e=e.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-left-row"),e=e.replace(/%MessageId%/g,"11"),e=e.replace(/%FromName%/g,""),e=e.replace(/%AvatarUrl%/g,""),e=e.replace(/%MessageContent%/g,SDKSource.GetLanguageData("we_got_email")),$("#divJetlinkMessageList").append(e),$("#divFromName_11").remove(),$("#imgAvatarUrl_11").remove(),$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3)}),$("#txtMessageContent").focus(),SDKSource.StartConversation())}):$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(e){e=e.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-left-row"),e=e.replace(/%MessageId%/g,"111222"),e=e.replace(/%FromName%/g,""),e=e.replace(/%AvatarUrl%/g,""),e=e.replace(/%MessageContent%/g,"<font color=red>"+SDKSource.GetLanguageData("invalid_email")+"</font>"),$("#divJetlinkMessageList").append(e),$("#divFromName_111222").remove(),$("#imgAvatarUrl_111222").remove(),$("#txtEmail").val(""),$("#txtEmail").focus(),$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3)}))}var t=$("#txtMessageContent").val();""!=t&&(""==SDKSource.General.SenderChatUserId&&$.get(SDKSource.General.BaseUrl+"/WebChatData/ChatUserDetail?email=&companyId="+SDKSource.General.CompanyId,function(e){""!=e&&(SDKSource.General.SenderChatUserId=e.ChatUserId,SDKSource.General.UserId=e.UserId,SDKSource.General.SenderChatUserPsw=e.ChatPsw,SDKSource.SetCookie("Jetlink-Visitor-ChatUserId",SDKSource.General.SenderChatUserId),SDKSource.SetCookie("Jetlink-Visitor-ChatUserPsw",SDKSource.General.SenderChatUserPsw),$("#txtMessageContent").focus(),SDKSource.StartConversation())}),""!=SDKSource.GetCookie("Jetlink-LastConversationId")&&$.get(SDKSource.General.BaseUrl+"/WebChatData/GetConversatonStatus?id="+SDKSource.GetCookie("Jetlink-LastConversationId"),function(e){""!=e&&("3"==e?SDKSource.General.IsNewConversation=!0:SDKSource.General.IsNewConversation=!1)}),$.ajax({url:SDKSource.General.BaseUrl+"/WebChatData/InsertUserMessage?isNewConversation="+SDKSource.General.IsNewConversation+"&fromUserChatId="+SDKSource.General.SenderChatUserId+"&toUserChatId="+SDKSource.General.CompanyChatUserId+"&message="+t,type:"GET",data:"",success:function(e){"null"!=e&&$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(t){t=t.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-right-row"),t=t.replace(/%MessageId%/g,e.MessageId),t=t.replace(/%FromName%/g,e.FromName),t=t.replace(/%AvatarUrl%/g,e.AvatarUrl),t=t.replace(/%MessageContent%/g,e.MessageContent),$("#divJetlinkMessageList").append(t),$("#divFromName_"+e.MessageId).remove(),""==e.AvatarUrl&&$("#imgAvatarUrl_"+e.MessageId).remove(),$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3),SDKSource.General.IsNewConversation=!1,SDKSource.SetCookie("Jetlink-LastConversationId",e.ConversationId)})}}),$("#txtMessageContent").val(""))},onConnect:function(e){SDKSource.ChatServer.ChatConnStatus=e,SDKSource.ChatServer.ChatConnStatus==Strophe.Status.CONNECTED&&(SDKSource.ChatServer.ChatConn.send($pres()),SDKSource.ChatServer.ChatConn.addHandler(SDKSource.onMessage,null,"message",null,null,null))},onMessage:function(e){var t=e.getElementsByTagName("body")[0],a=Strophe.getText(t);a=a.replace(/&quot;/g,'"');var r=jQuery.parseJSON(a);return $.ajax({url:SDKSource.General.BaseUrl+"/WebChatData/GetLastReceivedMessage?toUserId="+SDKSource.General.UserId,type:"GET",data:"",success:function(e){"null"!=e&&$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(t){t=t.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-left-row"),t=t.replace(/%MessageId%/g,e.MessageId),t=t.replace(/%FromName%/g,e.FromName),t=t.replace(/%AvatarUrl%/g,e.AvatarUrl),t=t.replace(/%MessageContent%/g,r.MessageText),t=""==e.AvatarUrl?t.replace(/%FromNameStyle%/g,"margin-left:0px;"):t.replace(/%FromNameStyle%/g,""),$("#divJetlinkMessageList").append(t),""==e.FromName&&$("#divFromName_"+e.MessageId).remove(),""==e.AvatarUrl&&$("#imgAvatarUrl_"+e.MessageId).remove(),void 0!=$("#jtlnk-conversation").height()&&$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3)})}}),!0},StartConversation:function(){var e=SDKSource.GetCookie("Jetlink-Visitor-UserId"),t=SDKSource.GetCookie("Jetlink-Visitor-ChatUserId"),a=SDKSource.GetCookie("Jetlink-Visitor-ChatUserPsw");""==e?$.get(SDKSource.General.BaseUrl+"/WebChatData/ChatUserDetail?email=&companyId="+SDKSource.General.CompanyId,function(e){""!=e&&(SDKSource.General.SenderChatUserId=e.ChatUserId,SDKSource.General.SenderChatUserPsw=e.ChatPsw,SDKSource.General.UserId=e.UserId)}):""==t||""==a?$.get(SDKSource.General.BaseUrl+"/WebChatData/GetUserDetailById?userId="+e,function(e){""!=e&&(t=e.ChatUserId,a=e.ChatUserPsw,SDKSource.General.SenderChatUserId=t,SDKSource.General.SenderChatUserPsw=a)}):(SDKSource.General.UserId=e,SDKSource.General.SenderChatUserId=t,SDKSource.General.SenderChatUserPsw=a),SDKSource.SetCookie("Jetlink-Visitor-ChatUserId",SDKSource.General.SenderChatUserId),SDKSource.SetCookie("Jetlink-Visitor-ChatUserPsw",SDKSource.General.SenderChatUserPsw),SDKSource.SetCookie("Jetlink-Visitor-UserId",SDKSource.General.UserId),SDKSource.ChatServer.ChatConn=new Strophe.Connection(SDKSource.ChatServer.BoshService),SDKSource.ChatServer.ChatConn.connect(SDKSource.General.SenderChatUserId,SDKSource.General.SenderChatUserPsw,SDKSource.onConnect),$("#txtEmail").val(""),$("#txtEmail").hide(),$("#txtMessageContent").show(),$("#btnMessageSend").show()},DisplayPreviousMessages:function(){var e=SDKSource.GetCookie("Jetlink-LastConversationId");""!=e&&($.get(SDKSource.General.BaseUrl+"/WebChatData/GetPreviousMessages?lastConversationId="+e+"&companyId="+SDKSource.General.CompanyId,function(e){for(var t=0;t<e.length;t++){var a=e[t];$.get(SDKSource.General.BaseUrl+"/files/html_templates/WebChatMessageItem.html",function(e){e=1==a.IsAgent?e.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-left-row"):e.replace(/%MessageCssClass%/g,"jtlnk-row jtlnk-right-row"),e=e.replace(/%MessageId%/g,a.MessageId),e=e.replace(/%FromName%/g,a.FromName),e=e.replace(/%AvatarUrl%/g,a.AvatarUrl),e=e.replace(/%MessageContent%/g,a.Content),e=""==a.AvatarUrl?e.replace(/%FromNameStyle%/g,"margin-left:0px;"):e.replace(/%FromNameStyle%/g,""),$("#divJetlinkMessageList").append(e),$("#divFromName_"+a.MessageId).remove(),""==a.AvatarUrl&&$("#imgAvatarUrl_"+a.MessageId).remove()})}}),$("#jtlnk-conversation").animate({scrollTop:$("#jtlnk-conversation")[0].scrollHeight},1e3))},validateEmail:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},CloseWebChatWindow:function(){$("#cssChatWindow").remove(),$("#jtlnk-holder").remove(),SDKSource.CreateChatLinkElement(),SDKSource.ApplyDeveloperSettings()},MessageKeyPress:function(e){13==e.which&&SDKSource.MessageSend()},EmailKeyPress:function(e){13==e.which&&SDKSource.MessageSend()},GetLanguageData:function(e){var t="";return $.each(SDKSource.Language.Data,function(a,r){return a==e?t=r[SDKSource.Language.Code]:void 0}),t},SetCookie:function(e,t){var a=new Date;a.setTime(a.getTime()+2592e6);var r="expires="+a.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"},GetCookie:function(e){for(var t=e+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var n=a[r];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}};